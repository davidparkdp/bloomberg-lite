<!DOCTYPE html>
<html>
<head>
<title>Bloomberg Lite</title>

<style>
body {
    background-color: black;
    color: #d0d0d0;
    font-family: monospace;
    margin: 0;
    padding: 8px;
}

.header {
    color: #ff9900;
    font-size: 13px;
    margin-bottom: 6px;
}

.topbar {
    color: #ff9900;
    font-size: 12px;
    margin-bottom: 6px;
}

.group-header {
    color: #ff9900;
    margin-top: 8px;
    margin-bottom: 2px;
    font-size: 12px;
}

.row {
    display: grid;
    grid-template-columns: 80px 100px 100px 100px;
    padding: 2px 4px;
    font-size: 12px;
}

.row:nth-child(even) {
    background-color: #0a0a0a;
}

.green { color: #00ff00; }
.red { color: #ff4d4d; }

.footer {
    margin-top: 6px;
    font-size: 11px;
    color: #666;
}
</style>
</head>

<body>

<div class="header">
BLOOMBERG LITE | Page <span id="pageNumber">1</span>
</div>

<div class="topbar" id="topBar"></div>

<div id="content"></div>

<div class="footer">
← → change page
</div>

<script>

const sheetURL = "YOUR_GOOGLE_SHEET_CSV_LINK";
const apiKey = "YOUR_FINNHUB_API_KEY";

let dataRows = [];
let currentPage = 0;
const perPage = 60; // tighter layout now

let previousPrices = {};

async function loadSheet() {
    const res = await fetch(sheetURL);
    const text = await res.text();

    const lines = text.split("\n")
        .map(l => l.trim())
        .filter(l => l.length > 0);

    dataRows = lines.map(line => {
        const parts = line.split(",");
        return {
            group: parts[0],
            ticker: parts[1]
        };
    });

    loadPage();
}

async function fetchQuote(symbol) {
    const res = await fetch(
        `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`
    );
    return await res.json();
}

async function loadPage() {

    const content = document.getElementById("content");
    content.innerHTML = "";

    const start = currentPage * perPage;
    const end = start + perPage;
    const pageRows = dataRows.slice(start, end);

    document.getElementById("pageNumber").innerText = currentPage + 1;

    const quotes = await Promise.all(
        pageRows.map(r => fetchQuote(r.ticker))
    );

    let currentGroup = "";

    for (let i = 0; i < pageRows.length; i++) {

        const { group, ticker } = pageRows[i];
        const q = quotes[i];

        if (!q || !q.c) continue;

        if (group !== currentGroup) {
            const gh = document.createElement("div");
            gh.className = "group-header";
            gh.innerText = group;
            content.appendChild(gh);
            currentGroup = group;
        }

        const row = document.createElement("div");
        row.className = "row";

        const changeClass = q.d >= 0 ? "green" : "red";

        if (previousPrices[ticker] && previousPrices[ticker] !== q.c) {
            row.style.backgroundColor =
                q.c > previousPrices[ticker] ? "#002200" : "#220000";
            setTimeout(() => {
                row.style.backgroundColor = "";
            }, 400);
        }

        previousPrices[ticker] = q.c;

        row.innerHTML = `
            <div>${ticker}</div>
            <div>$${q.c.toFixed(2)}</div>
            <div class="${changeClass}">
                ${q.d.toFixed(2)}
            </div>
            <div class="${changeClass}">
                ${q.dp.toFixed(2)}%
            </div>
        `;

        content.appendChild(row);
    }
}

async function loadTopBar() {

    const symbols = ["SPY","QQQ","DIA","VIX"];
    const quotes = await Promise.all(
        symbols.map(s => fetchQuote(s))
    );

    let html = "";

    for (let i = 0; i < symbols.length; i++) {
        const q = quotes[i];
        const color = q.d >= 0 ? "green" : "red";
        html += `${symbols[i]} 
            <span class="${color}">
            ${q.c.toFixed(2)} (${q.dp.toFixed(2)}%)
            </span> | `;
    }

    document.getElementById("topBar").innerHTML = html;
}

document.addEventListener("keydown", e => {
    if (e.key === "ArrowRight" && (currentPage + 1) * perPage < dataRows.length) {
        currentPage++;
        loadPage();
    }
    if (e.key === "ArrowLeft" && currentPage > 0) {
        currentPage--;
        loadPage();
    }
});

setInterval(() => {
    loadPage();
    loadTopBar();
}, 30000);

loadSheet();
loadTopBar();

</script>

</body>
</html>
