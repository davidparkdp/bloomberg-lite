<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bloomberg Lite</title>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
html, body {
    height: 100%;
    margin: 0;
    overflow: hidden;
    background: #0a0a0a;
    color: #00ffcc;
    font-family: monospace;
    font-size: 12px;
}

body {
    display: flex;
    flex-direction: column;
}

.header {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    color: orange;
    padding: 5px 10px;
    border-bottom: 1px solid #333;
    background: #111;
}
.header-title { font-size: 13px; font-weight: bold; letter-spacing: 1.5px; }
.header-time  { color: #888; font-size: 10px; margin-left: auto; }

.tabs {
    flex-shrink: 0;
    display: flex;
    gap: 2px;
    padding: 3px 10px;
    background: #111;
    border-bottom: 1px solid #333;
}
.tab {
    padding: 3px 12px;
    cursor: pointer;
    border: 1px solid #444;
    color: #888;
    background: transparent;
    font-size: 10.5px;
    letter-spacing: 0.8px;
}
.tab.active { border-color: orange; color: orange; background: rgba(255,165,0,.08); }

#pages {
    flex: 1;
    min-height: 0;
    overflow: hidden;
}
.page {
    display: none;
    height: 100%;
    padding: 4px 6px;
}
.page.active {
    display: flex;
    flex-direction: row;
    align-items: stretch;
    gap: 4px;
}

.col {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    padding: 0 3px;
    border-right: 1px solid #1a1a1a;
}
.col:last-child { border-right: none; }

.col-content {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    min-height: 0;
}

.group {
    color: orange;
    margin: 3px 0 1px 0;
    font-size: 9.2px;
    letter-spacing: 0.6px;
    border-bottom: 1px solid #222;
    padding: 1px 0;
    text-transform: uppercase;
    line-height: 1;
}
.group:first-of-type { margin-top: 2px; }

.row {
    display: grid;
    grid-template-columns: 45px 85px 62px 54px 52px 22px;
    padding: 1px 0;
    font-size: 11.8px;
    line-height: 1.3;
    border-bottom: 1px solid #0f0f0f;
    min-height: 16px;
    align-items: center;
}
.row:hover { background: #141414; }

.cell-ticker { font-weight: bold; color: #ffb300; cursor: pointer; }
.cell-name {
    color: #ffb300;
    font-size: 10.5px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    opacity: 0.9;
}
.cell-price, .cell-chg, .cell-pct { text-align: right; }
.cell-age { text-align: right; font-size: 8.8px; color: #ffb300; opacity: 0.7; }

.green { color: #00e676; }
.red   { color: #ff5252; }

.statusbar {
    flex-shrink: 0;
    background: #111;
    border-top: 1px solid #222;
    padding: 2px 10px;
    font-size: 9px;
    color: #555;
    display: flex;
    gap: 12px;
}

/* Extra bottom filler to reduce unevenness */
.col::after {
    content: "";
    flex: 999 1 auto;   /* very aggressive grow to fill */
    min-height: 0;
}

/* Tight on small height */
@media (max-height: 800px) {
    .row { font-size: 11.2px; min-height: 15px; }
    .cell-name { font-size: 10px; }
    .cell-age { font-size: 8.2px; }
    .group { font-size: 8.8px; margin: 2px 0 0; }
}
</style>
</head>
<body>
<div class="header">
    <div class="header-title">◆ BLOOMBERG LITE</div>
    <div class="header-time" id="clock"></div>
</div>
<div class="tabs" id="tabs"></div>
<div id="pages"></div>
<div class="statusbar">
    <span id="status">Loading…</span>
    <span id="counter"></span>
</div>

<script>
// ── same script as before, only changing buildMasterList for vertical fill ──

const API_KEY       = "d6atqi1r01qnr27isiq0d6atqi1r01qnr27isiqg";
const CALL_DELAY_MS = 1200;
const PAUSE_ON_429  = 65000;
const NUM_COLS      = 5;
const SHEET_URL     = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT46q9pwRZMT27tLH6taYNgIYXFPkLdnjOhv3KqqGJGJY_Dn1SJ6yI4v1jaODaHy33TwbM-L5z14UWF/pub?gid=0&single=true&output=csv";

// parseCSV, loadCSV, quoteStore, tickerMeta, masterList, numPages, sleep, setStatus etc. remain the same

// Only this function is adjusted for clarity + vertical fill
async function buildMasterList() {
    masterList = [];
    const rows = await loadCSV(SHEET_URL);
    const maxCols = Math.max(...rows.map(r => r.length));
    const allItems = [];

    for (let base = 0; base + 1 < maxCols; base += 3) {
        const gCol = base, tCol = base+1, nCol = base+2;
        rows.forEach(row => {
            const group  = row[gCol]?.trim()  || "";
            const ticker = row[tCol]?.trim() || "";
            const name   = row[nCol]?.trim()   || "";
            if (group && ticker) allItems.push({group, ticker, name});
        });
    }

    const seen = new Set();
    const unique = allItems.filter(item => !seen.has(item.ticker) && seen.add(item.ticker));

    // Vertical fill: column-major order
    const totalItems = unique.length;
    const colHeights = Array(NUM_COLS).fill(0).map((_,i) => Math.floor(totalItems / NUM_COLS) + (i < totalItems % NUM_COLS ? 1 : 0));

    let globalIdx = 0;
    for (let c = 0; c < NUM_COLS; c++) {
        for (let r = 0; r < colHeights[c]; r++) {
            if (globalIdx >= totalItems) break;
            const item = unique[globalIdx];
            const pageIdx = 0; // single page assumption for simplicity; expand if multi-page needed
            tickerMeta[item.ticker] = {
                group: item.group,
                name:  item.name,
                pageIdx,
                colIdx: c,
                order: r
            };
            masterList.push(item.ticker);
            globalIdx++;
        }
    }

    numPages = 1; // adjust if you have many items → Math.ceil(totalItems / (max per page))
}

// rest of script (buildChrome, switchPage, renderTicker, fetchQuote, rollingLoop, init) stays exactly as in your last working version
// ... paste the rest here ...

async function init() {
    setStatus("Reading sheet…");
    await buildMasterList();
    buildChrome();
    rollingLoop();
}

init();
</script>
</body>
</html>
