<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Bloomberg Lite</title>

<style>
body {
    margin: 0;
    background: black;
    color: #00ffcc;
    font-family: monospace;
}

.header {
    color: orange;
    padding: 10px;
    border-bottom: 1px solid orange;
}

.container {
    padding: 10px;
}

.group {
    color: orange;
    margin-top: 20px;
}

.row {
    display: grid;
    grid-template-columns: 120px 120px 120px 120px;
    padding: 4px 0;
}

.green { color: #00ff00; }
.red { color: #ff4444; }
</style>
</head>

<body>

<div class="header">
BLOOMBERG LITE
</div>

<div class="container" id="container"></div>

<script>

const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT46q9pwRZMT27tLH6taYNgIYXFPkLdnjOhv3KqqGJGJY_Dn1SJ6yI4v1jaODaHy33TwbM-L5z14UWF/pub?output=csv";
const API_KEY = "d6atqi1r01qnr27isiq0d6atqi1r01qnr27isiqg";

let tickers = [];

async function loadSheet() {
    const res = await fetch(SHEET_URL);
    const text = await res.text();
    const rows = text.trim().split("\n").map(r => r.split(","));

    tickers = rows.map(r => ({
        group: r[0]?.trim(),
        ticker: r[1]?.trim(),
        page: r[2]?.trim()
    })).filter(r => r.ticker && r.page == "1");

    loadQuotes();
}

async function fetchQuote(symbol) {
    const res = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${API_KEY}`);
    if (!res.ok) return null;
    return await res.json();
}

async function loadQuotes() {
    const container = document.getElementById("container");
    container.innerHTML = "";

    const groups = [...new Set(tickers.map(t => t.group))];

    for (let group of groups) {
        const groupDiv = document.createElement("div");
        groupDiv.className = "group";
        groupDiv.innerText = group;
        container.appendChild(groupDiv);

        const groupTickers = tickers.filter(t => t.group === group);

        for (let item of groupTickers) {
            const quote = await fetchQuote(item.ticker);
            if (!quote || quote.c == null) continue;

            const row = document.createElement("div");
            row.className = "row";

            const color = quote.d >= 0 ? "green" : "red";

            row.innerHTML = `
                <div>${item.ticker}</div>
                <div>$${quote.c.toFixed(2)}</div>
                <div class="${color}">${quote.d.toFixed(2)}</div>
                <div class="${color}">${quote.dp.toFixed(2)}%</div>
            `;

            container.appendChild(row);

            await new Promise(r => setTimeout(r, 350));
        }
    }
}

setInterval(loadQuotes, 30000);

loadSheet();

</script>

</body>
</html>
